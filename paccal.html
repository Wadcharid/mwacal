<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>คำนวณการใช้ PAC และการรับ PAC</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            width: 100%;
            max-width: 500px;
        }

        .input-group {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            font-size: 12px;
        }

        label {
            margin-right: 10px;
        }

        input {
            padding: 2px;
            max-width: 120px;
            font-size: 12px;
        }

        button {
            padding: 5px 10px;
            font-size: 12px;
        }

        .result {
            margin-top: 10px;
            font-size: 12px;
            font-weight: bold;
        }

        table {
            margin-top: 10px;
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }

        td.bold {
            font-weight: bold;
        }
    </style>
</head>

<body>
    <form id="pacForm">
        <div class="input-group">
            <label for="date">วันที่:</label>
            <input type="date" id="date">
        </div>

        <h3>Stock PAC ล่าสุด (m<sup>3</sup>)</h3>
        <div class="input-group">
            <label for="tankA">Tank A:</label>
            <input type="number" id="tankA" required>
        </div>
        <div class="input-group">
            <label for="tankB">Tank B:</label>
            <input type="number" id="tankB" required>
        </div>
        <div class="input-group">
            <label for="tankC">Tank C:</label>
            <input type="number" id="tankC" required>
        </div>
        <div class="input-group">
            <label for="tankD">Tank D:</label>
            <input type="number" id="tankD" required>
        </div>

        <h3>RW (m<sup>3</sup>/s)</h3>
        <div class="input-group">
            <label for="rw1">RW1:</label>
            <input type="number" id="rw1" required>
        </div>
        <div class="input-group">
            <label for="rw2">RW2:</label>
            <input type="number" id="rw2" required>
        </div>
        <div class="input-group">
            <label for="rw3">RW3:</label>
            <input type="number" id="rw3" required>
        </div>
        <div class="input-group">
            <label for="rw4">RW4:</label>
            <input type="number" id="rw4" required>
        </div>

        <h3>PAC Dose (mg/L)</h3>
        <div class="input-group">
            <label for="pacdose1">เฟส 1:</label>
            <input type="number" id="pacdose1" required>
        </div>
        <div class="input-group">
            <label for="pacdose2">เฟส 2:</label>
            <input type="number" id="pacdose2" required>
        </div>
        <div class="input-group">
            <label for="pacdose3">เฟส 3:</label>
            <input type="number" id="pacdose3" required>
        </div>
        <div class="input-group">
            <label for="pacdose4">เฟส 4:</label>
            <input type="number" id="pacdose4" required>
        </div>

        <button type="button" onclick="calculatePAC()">คำนวณการใช้ PAC และการรับ PAC</button>
    </form>

    <div class="result">
        <table id="resultTable">
            <thead>
                <tr>
                    <th>Stock คงเหลือ (ตัน)</th>
                    <th>การใช้ PAC รวม (ตัน)</th>
                    <th>จำนวนเที่ยวรถก่อนเที่ยง (เที่ยว)</th>
                    <th>จำนวนเที่ยวรถหลังเที่ยง (เที่ยว)</th>
                    <th><b>จำนวนเที่ยวรถรวม (เที่ยว)</b></th>
                    <th>Stock คงเหลือสิ้นสุดวัน (ตัน)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        document.getElementById('pacForm').addEventListener('submit', function (event) {
            event.preventDefault();
            calculatePAC();
        });

        function calculatePAC() {
            // Get input values
            const tankA = parseFloat(document.getElementById('tankA').value);
            const tankB = parseFloat(document.getElementById('tankB').value);
            const tankC = parseFloat(document.getElementById('tankC').value);
            const tankD = parseFloat(document.getElementById('tankD').value);

            const rw1 = parseFloat(document.getElementById('rw1').value);
            const rw2 = parseFloat(document.getElementById('rw2').value);
            const rw3 = parseFloat(document.getElementById('rw3').value);
            const rw4 = parseFloat(document.getElementById('rw4').value);

            const pacdose1 = parseFloat(document.getElementById('pacdose1').value);
            const pacdose2 = parseFloat(document.getElementById('pacdose2').value);
            const pacdose3 = parseFloat(document.getElementById('pacdose3').value);
            const pacdose4 = parseFloat(document.getElementById('pacdose4').value);

            // Calculate PAC Use for each phase
            const pacuse1 = (pacdose1 * rw1 * 3600 * 24) / 1000 / 1000 / 0.35;
            const pacuse2 = (pacdose2 * rw2 * 3600 * 24) / 1000 / 1000 / 0.35;
            const pacuse3 = (pacdose3 * rw3 * 3600 * 24) / 1000 / 1000 / 0.35;
            const pacuse4 = (pacdose4 * rw4 * 3600 * 24) / 1000 / 1000 / 0.35;

            // Total PAC use per day
            const totalPacUse = pacuse1 + pacuse2 + pacuse3 + pacuse4;

            // Convert Tank A, B, C, D from m3 to tons
            const tankA_ton = tankA * 1.19;
            const tankB_ton = tankB * 1.19;
            const tankC_ton = tankC * 1.19;
            const tankD_ton = tankD * 1.19;

            // Calculate total stock at 00:00 (Day 1)
            let pacstock1 = tankA_ton + tankB_ton + tankC_ton + tankD_ton;

            const resultTableBody = document.querySelector('#resultTable tbody');
            resultTableBody.innerHTML = ''; // Clear previous results

            // Get input date
            const inputDate = document.getElementById('date').value;
            let startDate = inputDate ? new Date(inputDate) : null;

            // Loop for 10 days calculation
            for (let day = 1; day <= 10; day++) {
                // Calculate number of PAC car trips for the day
                const pac_car1 = Math.floor(((110 - pacstock1) + (totalPacUse * 0.25)) / 15);
                const pac_car2 = Math.floor((((110 - pacstock1) + totalPacUse) / 15) - pac_car1);

                // Calculate total trips for the day
                const totalTrips = pac_car1 + pac_car2;

                // Update PAC stock for the next day
                const pacstock2 = pacstock1 - totalPacUse + (pac_car1 * 15) + (pac_car2 * 15);

                // Format date
                let dateString = inputDate ? startDate.toLocaleDateString() : `วันที่ ${day}`;
                if (startDate) startDate.setDate(startDate.getDate() + 1); // Increment date if applicable

                // Add row to the table
                const row = `<tr>
                    <td>${pacstock1.toFixed(2)} ตัน</td>
                    <td>${totalPacUse.toFixed(2)} ตัน</td>
                    <td>${pac_car1} เที่ยว</td>
                    <td>${pac_car2} เที่ยว</td>
                    <td class="bold">${totalTrips} เที่ยว</td>
                    <td>${pacstock2.toFixed(2)} ตัน</td>
                </tr>`;
                resultTableBody.insertAdjacentHTML('beforeend', row);

                // Update for the next iteration
                pacstock1 = pacstock2;
            }
        }
    </script>
</body>

</html>
